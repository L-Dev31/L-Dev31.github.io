<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Axonis — Comptabilité</title>
  <link rel="icon" href="favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="mobile.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

</head>
<body>
  <div class="mobile-tabs" role="tablist">
    <button id="tab-btn-preview" role="tab" aria-selected="true" aria-controls="preview-container" class="active">Aperçu</button>
    <button id="tab-btn-form" role="tab" aria-selected="false" aria-controls="form-container">Formulaire</button>
  </div>
  <div class="split">
    <div class="container" id="form-container">
    
    <form id="rowForm" autocomplete="off">
      <h1 id="formTitle">Nouvelle facture</h1>
      <div class="grid">
        <div style="display: flex; gap: 12px; align-items: end;">
          <div style="flex:1; display: flex; flex-direction: column; gap: 6px;">
            <label for="invoice_number" style="margin-bottom:2px;">Numéro de facture</label>
            <input type="text" id="invoice_number" placeholder="Ex. 2025-1" required style="min-width:0;">
          </div>
          <div style="width:24px;"></div>
          <div style="flex:1; display: flex; flex-direction: column; gap: 6px;">
            <label for="invoice_date" style="margin-bottom:2px;">Date de la facture <span style="font-weight:600;color:var(--muted);font-size:12px">(optionnel)</span></label>
            <input type="date" id="invoice_date" placeholder="Date facture" title="Date de la facture" style="min-width:0;">
          
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:end;">
          <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
              <label for="client_name">Nom et prénom du client</label>
              <input type="text" id="client_name" placeholder="Nom Prénom" required>
            </div>
          <div style="width:12px;"></div>
          <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
            <label for="client_email">Email <span style="font-weight:600;color:var(--muted);font-size:12px">(optionnel)</span></label>
            <input type="email" id="client_email" placeholder="email@exemple.com">
            <div id="client_email_error" class="field-error" style="display:none">Adresse e-mail invalide</div>
          </div>
        </div>
        <div class="full">
          <label for="payment_method">Mode de règlement</label>
            <select id="payment_method" name="payment_method" required>
              <option value="" disabled selected>Sélectionner</option>
              <option value="Espèces">Espèces</option>
              <option value="Chèque">Chèque</option>
              <option value="Virement bancaire">Virement bancaire</option>
              <option value="Carte bancaire">Carte bancaire</option>
              <option value="Autre">Autre</option>
          </select>
          <label for="payment_method_other" style="margin-top:8px;display:none" id="payment_method_other_label">Précisez le mode de règlement <span style="font-weight:600;color:var(--muted);font-size:12px">(optionnel)</span></label>
          <input type="text" id="payment_method_other" placeholder="Précisez le mode de règlement... (optionnel)" style="display:none;margin-top:8px;" />
          <label for="payment_note" style="margin-top:8px;display:block">Référence / note paiement <span style="font-weight:600;color:var(--muted);font-size:12px">(optionnel)</span></label>
          <input type="text" id="payment_note" placeholder="Ex: virement le 02/08/24, ch 7185423" style="margin-top:6px;" />
          
        </div>

        <div style="display:flex;gap:12px;align-items:end;">
          <div style="flex:2;display:flex;flex-direction:column;gap:6px;">
            <label for="service_type">Type de séance <span style="font-weight:600;color:var(--muted);font-size:12px">(optionnel)</span></label>
            <select id="service_type" aria-label="Type de séance">
              <option value="" disabled selected>Sélectionner un type de séance…</option>
              <option value="70">1 séance d'ostéopathie (45min) — 70€</option>
              <option value="70">1 massage bien-être (60min) — 70€</option>
              <option value="90">1 massage bien-être (90min) — 90€</option>
              <option value="100">Pack gommage + massage — 100€</option>
              <option value="autre">Autre…</option>
            </select>
            <div id="autre_seance_zone" style="display:none; margin-top:8px; gap:8px; align-items:end;">
              <input type="text" id="autre_seance_desc" placeholder="Description de la séance (optionnel)" style="flex:2;" />
              <input type="number" id="autre_seance_prix" placeholder="Prix (€) (optionnel)" min="0" step="0.01" style="flex:1;" />
            </div>
          
          </div>
          <div style="width:12px"></div>
          <div style="width:140px;display:flex;flex-direction:column;gap:6px;">
            <label for="service_quantity">Quantité</label>
            <input type="number" id="service_quantity" min="1" step="1" value="1" style="padding:10px;border:1px solid #e6efe6;border-radius:6px" />
          </div>
        </div>

        <div class="full totalRow" style="text-align:right">
          <div class="small">Total</div>
          <div id="priceBig" style="font-size:26px;color:var(--accent);font-weight:800">0 €</div>
        </div>

        <div class="full">
        </div>

        <div class="full small" style="display:flex;justify-content:space-between;align-items:center">
        </div>
      </div>

      <div class="controls">
        <button id="addBtn" type="submit" disabled><i class="fa-solid fa-plus" aria-hidden="true"></i>Entrer</button>
        <button id="downloadBtn" type="button" disabled style="margin-left:8px"><i class="fa-solid fa-download" aria-hidden="true"></i>Télécharger</button>
        <!-- send button removed -->
        <button id="cancelEditBtn" type="button" class="secondary" style="display:none;margin-left:8px">Annuler</button>
      </div>
    </form>

    

    
  </div>

  
    <div class="container" id="preview-container">
    <div class="preview">
      <h2>Aperçu</h2>
      <div class="actions small">
        <div style="margin-left:12px;display:flex;gap:8px;align-items:center">
          <button id="importCsvBtn" type="button" class="secondary">Importer CSV</button>
          <button id="exportCsvBtn" type="button" class="secondary">Exporter CSV</button>
          <button id="wipeBtn" type="button" class="secondary">Vider la table</button>
          <input id="importCsvInput" type="file" accept=".csv,text/csv" style="display:none" />
        </div>
      </div>
      
      <div id="cardsContainer" class="cards">
        
        <div id="previewCard" class="card">
          <div class="pfp" id="previewPfp">?</div>
          <div class="info">
            <div class="row">
                  <div>
                    <strong id="previewClient">Nom Prénom</strong>
                    <div class="meta" id="previewService">Prestation</div>
                    <div class="meta" id="previewEmail" style="color:var(--muted);font-size:13px">&nbsp;</div>
                  </div>
              <div class="amount" id="previewTotal">0 €</div>
            </div>
            <div class="row">
              <div class="meta" id="previewInvoice">N° — • —</div>
              <div class="meta" id="previewPayment">Mode paiement</div>
            </div>
          </div>
        </div>
        <!-- Sort dropdown moved here so it sits directly under the preview card -->
        <div class="previewControls" style="margin-top:10px; margin-bottom:6px; display:flex; gap:8px; align-items:center; justify-content:space-between">
          <select id="sortOrder" class="smallSelect" title="Ordre d'affichage" style="flex:0 0 auto">
            <option value="desc">Plus récentes en haut</option>
            <option value="asc">Plus anciennes en haut</option>
          </select>
          <!-- Search (same visual style as dropdown) with FontAwesome magnifier -->
          <div class="searchWrap">
            <i class="fa-solid fa-magnifying-glass searchIcon" aria-hidden="true"></i>
            <input id="searchInput" class="smallSearch" type="search" placeholder="Rechercher (nom ou n° facture)" aria-label="Recherche par nom ou numéro" />
          </div>
          <div id="clientsCount" class="small" style="margin-left:12px; white-space:nowrap">0 clients enregistrés</div>
        </div>
        <div id="cardsTotals" style="margin-bottom:8px"></div>
        <div id="cardsList"></div>
      </div>
    </div>
    </div>
  </div>

  <div class="toast" role="status" aria-live="polite">&nbsp;</div>

  <script src="app.js"></script>
</body>
</html>
