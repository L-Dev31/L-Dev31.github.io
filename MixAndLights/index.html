<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mix And Lights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <!-- Start Loader Section -->
    <div id="loader">
        <div id="counter">0%</div>
        <div id="completion-bar"></div>
    </div>
    <!-- End Loader Section -->

    <!-- Start Header Section -->
    <header>
        <div class="navbar-top-gradient"></div>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
            <div class="container">
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">A propos</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="reservationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Reservation
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="reservationDropdown">
                                <li><a class="dropdown-item" href="#">Services Particuliers</a></li>
                                <li><a class="dropdown-item" href="#">Services Professionels</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <a class="navbar-brand mx-auto" href="#">
                    <img src="images/logo-big.svg" alt="Logo">
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavRight" aria-controls="navbarNavRight" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNavRight">
                     <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#">Boutique</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Contact</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="langueDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Langue
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="langueDropdown">
                                <li><a class="dropdown-item" href="#"><img src="https://flagcdn.com/w20/fr.png" class="flag-icon" alt="French Flag">Français</a></li>
                                <li><a class="dropdown-item" href="#"><img src="https://flagcdn.com/w20/gb.png" class="flag-icon" alt="English Flag">Anglais</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <!-- End Header Section -->

    <!-- Start Main Section -->
    <main>
        <video id="circle-video" autoplay muted loop playsinline>
            <source src="images/bg.mp4" type="video/mp4">
        </video>
        <div id="video-overlay"></div>
        <div id="vignette-overlay"></div>
        <img src="images/logo-big.svg" alt="Logo" id="circle-logo">
    </main>
    <!-- End Main Section -->

    <!-- Start Scene 2 Section -->
    <section id="scene2">
        <div>
            <h1 class="slogan">Shine Bright</h1>
            <p class="description">Spécialistes de la musique, du son et de la lumière, nous mettons notre expertise au service de vos événements. De la conception lumière aux effets spéciaux, en passant par la sonorisation, nous créons des ambiances uniques et mémorables.</p>
        </div>
    </section>
    <!-- End Scene 2 Section -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="Scripts/script.js"></script>
    <script>
        // New loader logic will go here
        const resourcesToLoad = [
            'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css',
            'styles/style.css',
            'images/logo-big.svg',
            'https://flagcdn.com/w20/fr.png',
            'https://flagcdn.com/w20/gb.png',
            'images/bg.mp4',
            'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js',
            'Scripts/script.js',
            'fonts/Raustila.ttf', // Assuming these are loaded via CSS @font-face, but we'll try to load them directly for tracking
            'fonts/Regular.otf', // Assuming these are loaded via CSS @font-face, but we'll try to load them directly for tracking
            'Team/favicon.png',
            'Team/logo.png',
            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css',
            'https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap'
        ];

        let loadedCount = 0;
        const totalResources = resourcesToLoad.length;
        const loader = document.getElementById('loader');
        const counter = document.getElementById('counter');
        const completionBar = document.getElementById('completion-bar');

        function updateProgress() {
            const percentage = (loadedCount / totalResources) * 100; // No Math.floor here
            const displayedPercentage = percentage; // Use actual percentage
            counter.textContent = `${Math.floor(displayedPercentage)}%`; // Floor for display, but not for rounding to 10s
            completionBar.style.setProperty('--completion-width', `${displayedPercentage}%`); // Use actual percentage for bar

            console.log(`Progress: ${loadedCount}/${totalResources} (${percentage}%) - Displayed: ${Math.floor(displayedPercentage)}%`);

            if (loadedCount === totalResources) {
                console.log('All resources loaded!');
                loader.classList.add('loader-hidden');
                loader.addEventListener('transitionend', () => {
                    loader.remove();
                });
            }
        }

        resourcesToLoad.forEach(url => {
            let resource;
            if (url.endsWith('.css')) {
                resource = document.createElement('link');
                resource.rel = 'stylesheet';
                resource.href = url;
                document.head.appendChild(resource);
            } else if (url.endsWith('.js')) {
                resource = document.createElement('script');
                resource.src = url;
                document.body.appendChild(resource);
            } else if (url.endsWith('.mp4')) {
                resource = document.createElement('video');
                resource.src = url;
                resource.preload = 'auto'; // Start loading immediately
                // Use loadeddata or canplaythrough for video
                resource.addEventListener('loadeddata', () => {
                    loadedCount++;
                    console.log(`Loaded (Video): ${url}`);
                    updateProgress();
                });
                resource.addEventListener('error', () => { // Also listen for error on video element
                    loadedCount++;
                    console.log(`Error (Video): ${url}`);
                    updateProgress();
                });
            } else if (url.endsWith('.ttf') || url.endsWith('.otf')) {
                resource = new XMLHttpRequest();
                resource.open('GET', url);
                resource.responseType = 'blob';
            } else {
                resource = new Image();
                resource.src = url;
            }

            if (resource instanceof XMLHttpRequest) {
                resource.onload = () => {
                    loadedCount++;
                    console.log(`Loaded (XHR): ${url}`);
                    updateProgress();
                };
                resource.onerror = () => {
                    loadedCount++;
                    console.log(`Error (XHR): ${url}`);
                    updateProgress();
                };
                resource.send();
            } else if (resource.tagName === 'VIDEO') { // Skip default onload/onerror for video, handled by event listeners
                // Do nothing here, events are handled by addEventListener above
            } else {
                resource.onload = () => {
                    loadedCount++;
                    console.log(`Loaded: ${url}`);
                    updateProgress();
                };
                resource.onerror = () => {
                    loadedCount++;
                    console.log(`Error: ${url}`);
                    updateProgress();
                };
            }
        });

        // Initial update for 0%
        updateProgress();
    </script>
</body>
</html>
        });

        // Initial update for 0%
        updateProgress();
    </script>
</body>
</html>