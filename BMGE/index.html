<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>L-Dev's BMG Editor</title>
  <link rel="icon" href="favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <header class="page-header">
    <img src="logo.png" alt="Logo" style="height: 300px; width: auto; display: block; margin: 0 auto;">
    <h1>BMG Editor</h1>
    <p class="tagline">Load a .bmg file, review each entry, adjust the text, and export a patched archive without breaking the original offsets.</p>
  </header>
  <main>
    <section class="panel" id="loader-panel">
      <div class="file-picker">
        <label class="button" for="file-input">Select BMG file</label>
        <input id="file-input" type="file" accept=".bmg" hidden>
        <button id="open-folder-btn" class="button ghost" type="button"><i class="fas fa-folder-open"></i> Open Folder</button>
        <input id="folder-input" type="file" webkitdirectory hidden>
        <span id="file-label">No file selected</span>
      </div>
      <div class="meta" id="file-meta"></div>
      <div id="game-config-loader" class="game-config-loader">
        <div class="game-config-bg"></div>
        <div class="game-config-content">
          <div class="game-config-dropdown">
            <div style="display: flex; flex-direction: column; gap: 0.3em; width: max-content;">
              <label for="game-config-select" class="game-config-label">Game config:</label>
              <div class="game-config-select-wrapper">
                <select id="game-config-select" class="game-config-select">
                  <option value="tomodachicollection">Tomodachi Collection</option>
                  <!-- <option value="newsupermariobros">New Super Mario Bros.</option> -->
                </select>
                <img id="game-config-icon" class="game-icon" alt="" />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="file-warning"></div>
      <div class="search-container">
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input id="search" type="search" placeholder="Filter by text" disabled>
          <i class="fas fa-times search-clear" style="display: none;"></i>
        </div>
      </div>
      <div class="filters-container">
        <div class="filter-types">
          <label class="filter-checkbox">
            <input type="checkbox" id="filter-single" checked>
            <span>Single Entries</span>
          </label>
          <!-- Sequenced entries filter removed (no longer needed) -->
          <label class="filter-checkbox">
            <input type="checkbox" id="filter-modified" checked>
            <span>Show Modified</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" id="filter-empty" checked>
            <span>Show Empty</span>
          </label>
        </div>
        <div class="spacer"></div>
        <div class="action-buttons">
          <button id="import-json" class="ghost" type="button" disabled>Import JSON</button>
          <button id="export-json" class="ghost" type="button" disabled>Export JSON</button>
          <button id="download" type="button" disabled>Download BMG</button>
        </div>
      </div>
      <input id="import-json-input" type="file" accept="application/json,.json" hidden>
      <div class="status-info" id="status-info"></div>
    </section>

    <section class="panel" id="entries-panel">
      <header class="panel-header">
        <h2>Entries</h2>
        <span id="entry-count">0 items</span>
      </header>
      <div id="entries"></div>
    </section>
  </main>

  <template id="entry-template">
    <article class="entry-card">
      <header class="entry-heading">
        <h3></h3>
        <div class="badges"></div>
      </header>
      <label class="entry-editor">
        <span>Text</span>
        <div class="editor-shell">
          <pre class="text-highlight" aria-hidden="true"></pre>
          <textarea spellcheck="false"></textarea>
        </div>
        <div class="entry-actions">
          <div class="entry-helper">
            <span class="char-count"></span>
            <span class="offset"></span>
            <span class="attr"></span>
          </div>
          <button type="button" class="ghost revert" disabled>Revert</button>
        </div>
      </label>
    </article>
  </template>

  <!-- Folder sidebar -->
  <div class="folder-sidebar-overlay" id="folder-sidebar-overlay"></div>
  <aside class="folder-sidebar" id="folder-sidebar">
    <div class="folder-sidebar-header">
      <h3 id="folder-name">Folder</h3>
      <div class="folder-sidebar-actions">
        <button id="folder-zip-btn" type="button" title="Download folder as ZIP"><i class="fas fa-file-archive"></i></button>
        <button id="folder-close-btn" type="button" title="Close folder"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <div class="folder-file-list" id="folder-file-list"></div>
  </aside>
  <button id="folder-minimize-btn" class="folder-sidebar-tab" type="button" title="Minimize sidebar"><i class="fas fa-chevron-left"></i></button>
  <button id="folder-reopen-btn" class="folder-sidebar-tab" type="button" title="Open sidebar"><i class="fas fa-chevron-right"></i></button>

  <!-- Fixed bottom-right toolbar -->
  <div class="floating-toolbar" id="floating-toolbar">
    <button id="toolbar-new" type="button" title="New message"><i class="fas fa-plus"></i></button>
    <button id="toolbar-undo" type="button" title="Undo" disabled><i class="fas fa-undo"></i></button>
    <button id="toolbar-redo" type="button" title="Redo" disabled><i class="fas fa-redo"></i></button>
  </div>

  <!-- New message modal -->
  <div class="modal-overlay" id="new-msg-modal">
    <div class="modal-card modal-wide">
      <h3>New Message <span style="opacity: 0.6;">(Experimental)</span></h3>
      <p class="modal-desc">Configure the new message.</p>
      <label class="modal-label">Message ID</label>
      <input id="new-msg-id-input" type="text" inputmode="numeric" placeholder="Message ID" autocomplete="off">
      <span id="new-msg-id-error" class="modal-error"></span>
      <label class="modal-label">Message Text</label>
      <textarea id="new-msg-text-input" class="modal-textarea" placeholder="Message text (optional)" rows="3" spellcheck="false"></textarea>
      <label class="modal-label">Attribute</label>
      <div class="modal-attr-row">
        <input id="new-msg-attr-input" type="text" placeholder="00 00 00 00 00 00 00 00" autocomplete="off" spellcheck="false">
        <input id="new-msg-attr-size" type="number" min="0" max="255" value="8" title="Attribute size (bytes)">
      </div>
      <span id="new-msg-attr-error" class="modal-error"></span>
      <div class="modal-actions">
        <button id="new-msg-cancel" type="button" class="ghost">Cancel</button>
        <button id="new-msg-confirm" type="button">Create</button>
      </div>
    </div>
  </div>

  <!-- Delete confirmation modal -->
  <div class="modal-overlay" id="delete-confirm-modal">
    <div class="modal-card modal-danger">
      <h3><i class="fas fa-exclamation-triangle"></i> Delete Message <span style="opacity: 0.6;">(Experimental)</span></h3>
      <p class="modal-desc">Are you sure you want to delete this message? This action can be undone.</p>
      <div class="modal-actions">
        <button id="delete-confirm-cancel" type="button" class="ghost">Cancel</button>
        <button id="delete-confirm-confirm" type="button" class="danger">Delete</button>
      </div>
    </div>
  </div>

  <!-- Delete file confirmation modal -->
  <div class="modal-overlay" id="delete-file-modal">
    <div class="modal-card modal-danger">
      <h3><i class="fas fa-exclamation-triangle"></i> Delete File</h3>
      <p class="modal-desc" id="delete-file-desc">Are you sure you want to delete this file? You can undo this action.</p>
      <div class="modal-actions">
        <button id="delete-file-cancel" type="button" class="ghost">Cancel</button>
        <button id="delete-file-confirm" type="button" class="danger">Delete</button>
      </div>
    </div>
  </div>

  <!-- Edit ID modal -->
  <div class="modal-overlay" id="edit-id-modal">
    <div class="modal-card">
      <h3>Change ID</h3>
      <p class="modal-desc">Enter the new ID for this message.</p>
      <input id="edit-id-input" type="text" inputmode="numeric" placeholder="New Message ID" autocomplete="off">
      <span id="edit-id-error" class="modal-error"></span>
      <div class="modal-actions">
        <button id="edit-id-cancel" type="button" class="ghost">Cancel</button>
        <button id="edit-id-confirm" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Edit Attribute modal -->
  <div class="modal-overlay" id="edit-attr-modal">
    <div class="modal-card modal-wide">
      <h3>Change Attribute</h3>
      <p class="modal-desc">Edit the attribute for this message.</p>
      <label class="modal-label">Attribute</label>
      <div class="modal-attr-row">
        <input id="edit-attr-input" type="text" placeholder="00 00 00 00 00 00 00 00" autocomplete="off" spellcheck="false">
        <input id="edit-attr-size" type="number" min="0" max="255" value="8" title="Attribute size (bytes)">
      </div>
      <span id="edit-attr-error" class="modal-error"></span>
      <div class="modal-actions">
        <button id="edit-attr-cancel" type="button" class="ghost">Cancel</button>
        <button id="edit-attr-confirm" type="button">Save</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
